🛡️ 重大なセキュリティ課題と推奨事項

1. XSS（クロスサイトスクリプティング）リスク

- dangerouslySetInnerHTML を /app/announcements/[id]/page.tsx で使用していますが、サニタイズ処理がありません。
- 推奨: isomorphic-dompurify などで HTML をサニタイズしてください。

```
import DOMPurify from "isomorphic-dompurify";
<div
  className="whitespace-pre-wrap"
  dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(announcement.content) }}
/>
```

2. セキュリティヘッダーの未設定

- Next.js の next.config.ts やミドルウェアで CSP, X-Frame-Options, X-XSS-Protection などのセキュリティヘッダーが設定されていません。
- 推奨: next.config.ts に以下を追加してください。

```
   async headers() {
   return [
   {
   source: "/(.\*)",
   headers: [
   { key: "X-Frame-Options", value: "DENY" },
   { key: "X-Content-Type-Options", value: "nosniff" },
   { key: "Referrer-Policy", value: "origin-when-cross-origin" },
   { key: "X-XSS-Protection", value: "1; mode=block" },
   ],
   },
   ];
   }
```

3. 入力バリデーションの不十分

- /app/contact/page.tsx のバリデーションは「本文が空でない」だけです。メールアドレスや件名の長さ・形式チェックがありません。
- 推奨: Zod などでサーバー側でもバリデーションを強化してください。

4. API レートリミットの欠如

- 推奨: @upstash/ratelimit などで API レートリミットを実装してください。
- Contact API などにレートリミットがありません。スパムや DoS 攻撃のリスクがあります。

5. 認証・認可の未実装

- スレッド作成やレス投稿、問い合わせ API に認証がありません。現状は匿名掲示板として設計されていますが、悪用リスクがあります。
- 推奨: 必要に応じて簡易認証や IP ベースの制限を検討してください。

6. dangerouslySetInnerHTML 以外の XSS リスク

- スレッド本文やレスポンス本文の表示部分は dangerouslySetInnerHTML を使っていませんが、将来的に HTML を扱う場合は必ずサニタイズしてください。
